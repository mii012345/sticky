# Sticky - チームブレインストーミングアプリ 仕様書

## 概要

**Sticky** は、チームでアイデアを出し合うためのリアルタイム付箋ボードアプリです。
シンプルな操作で付箋を追加・移動・グルーピングでき、匿名モードやタイマー機能でブレストを効率化します。

---

## 技術スタック

| カテゴリ | 技術 |
|---------|------|
| フロントエンド | Next.js (React) |
| バックエンド | Firebase |
| データベース | Firestore |
| リアルタイム同期 | Firebase Realtime Database または Firestore |
| ホスティング | Vercel / Firebase Hosting |

---

## 画面構成

### 1. ボード作成画面

新しいブレストボードを作成する画面。

#### 入力項目

| 項目 | 必須 | 説明 |
|------|------|------|
| ボード名 | ○ | ボードのタイトル（例: Q1 プロダクト企画ブレスト） |
| チーム名 | - | チームや部署の名前（例: マーケティングチーム） |
| 説明 | - | ボードの目的や議題 |

#### オプション

| オプション | 説明 |
|------------|------|
| 匿名モード | ON にすると、付箋に投稿者名を表示しない |
| タイマー設定 | ON にすると、ブレスト時間を設定できる |

#### アクション

- **ボードを作成**: 入力内容でボードを作成し、ボード画面へ遷移
- **キャンセル**: ボード作成をキャンセル

---

### 2. ボード画面（メイン画面）

付箋を追加・編集・整理するメイン画面。

#### ヘッダー

| 要素 | 説明 |
|------|------|
| ロゴ | 「Sticky」ロゴ |
| ボード名 | 現在のボード名を表示 |
| 匿名モードバッジ | 匿名モード時に表示 |
| 参加者アイコン | 現在の参加者をアバターで表示 |
| 招待ボタン | 参加用 URL をコピーするダイアログを開く |

#### サブヘッダー

- チーム名
- アイデア数（「◯個のアイデア」）

#### キャンバス

- 付箋をドラッグ&ドロップで自由に配置
- クリックで付箋を追加
- 付箋同士をドラッグ&ドロップでグルーピング
- **ズーム機能**: ピンチイン/アウト、またはCtrl+ホイールで拡大・縮小（25%〜300%）
- **パン機能**: 二本指スワイプ、またはスペースキー + ドラッグでキャンバス移動
- **ズームコントロール**: 右下に +/- ボタン、ズーム率表示、リセットボタン

#### 付箋入力フォーム（右下固定）

- テキスト入力エリア（プレースホルダー: 「ここにアイデアを書く...」）
- 追加ボタン

---

## 機能詳細

### 付箋機能

#### 付箋の作成

- 入力フォームにテキストを入力して「追加」ボタンをクリック
- またはキャンバス上でクリックして直接追加

#### 付箋の表示

| 項目 | 説明 |
|------|------|
| テキスト | 付箋の内容 |
| 投稿者名 | 匿名モード OFF 時のみ表示 |
| いいね数 | いいねの合計数 |
| 色 | 通常は固定色（黄色）、グループ内はランダム色 |
| 傾き | **常に垂直（rotation: 0）** - 斜めにしない |

#### 付箋の操作

| 操作 | 説明 |
|------|------|
| ドラッグ | 付箋を移動 |
| 編集 | 自分の付箋のみテキストを編集可能 |
| 削除 | 自分の付箋のみ削除可能 |
| いいね | 各付箋に1回いいねできる |

---

### グルーピング機能（iPhone フォルダ風）

付箋をドラッグして別の付箋にドロップすると、グループが作成される。

#### グループの特徴

- グループには名前を付けられる
- グループ内の付箋にはランダムで色が付く
- グループを展開/折りたたみ可能
- グループから付箋をドラッグして取り出せる
- **常に垂直（rotation: 0）** - 斜めにしない

#### グループの操作

| 操作 | 説明 |
|------|------|
| 作成 | 付箋を別の付箋にドロップ |
| 名前変更 | グループ名をクリックして編集 |
| 付箋追加 | 付箋をグループにドロップ |
| 付箋取り出し | グループ内の付箋をドラッグで外に出す |
| 付箋並べ替え | グループ内の付箋をドラッグ&ドロップで順序変更 |
| 解散 | グループを解散して付箋を個別に戻す |

---

### いいね機能

- 各付箋に対して1人1回いいねできる
- いいね数は付箋上に表示
- 自分がいいねした付箋は視覚的に区別

---

### 匿名モード

- ボード作成時に ON/OFF を設定
- ON の場合、全ての付箋で投稿者名が非表示
- ヘッダーに「匿名モード」バッジを表示

---

### タイマー機能

- ボード作成時に時間を設定（5分、10分、15分、30分、カスタム）
- ヘッダーにカウントダウンを表示
- 残り1分で警告表示
- 終了時に通知（視覚的 + 音）
- タイマー終了後も編集は可能（表示のみの機能）

---

### 招待機能

- 「招待」ボタンをクリックでダイアログ表示
- ボードの URL をワンクリックでコピー
- URL を知っている人は誰でも参加可能

---

### 参加者表示

- ヘッダーに現在の参加者をアバターアイコンで表示
- 最大5人まで表示、それ以上は「+N」で省略
- 参加時にニックネームを入力

---

## 認証・参加フロー

### 新規参加フロー

1. 招待 URL にアクセス
2. ニックネーム入力ダイアログが表示
3. ニックネームを入力して「参加」
4. ボード画面に遷移

### 再参加フロー

- ブラウザの localStorage にニックネームを保存
- 同じボードに再アクセス時は自動で参加

---

## データモデル

### Board（ボード）

```typescript
interface Board {
  id: string;
  name: string;
  teamName?: string;
  description?: string;
  isAnonymous: boolean;
  timerMinutes?: number;
  timerStartedAt?: Timestamp;
  createdBy: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

### Sticky（付箋）

```typescript
interface Sticky {
  id: string;
  boardId: string;
  content: string;
  authorId: string;
  authorName: string;
  x: number;
  y: number;
  groupId?: string;
  orderInGroup?: number; // グループ内での並び順（0から始まる）
  color?: string;
  likes: string[]; // いいねしたユーザーID配列
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

### Group（グループ）

```typescript
interface Group {
  id: string;
  boardId: string;
  name: string;
  x: number;
  y: number;
  createdAt: Timestamp;
}
```

### Participant（参加者）

```typescript
interface Participant {
  id: string;
  boardId: string;
  userId: string;
  nickname: string;
  avatarColor: string;
  joinedAt: Timestamp;
  lastActiveAt: Timestamp;
}
```

---

## 非機能要件

### パフォーマンス

- リアルタイム同期の遅延: 500ms 以内
- 1ボードあたり最大付箋数: 200枚
- 同時参加者数: 最大20人

### データ保存

- ボードは作成者が手動で削除するまで永久保存
- 削除は作成者のみ可能

### セキュリティ

- ボード URL は推測困難なランダム文字列（UUID）
- Firebase Security Rules で権限制御

---

## 今後の拡張候補（スコープ外）

- [ ] メール招待機能
- [ ] QR コード招待
- [ ] 複数リアクション（ハート、なるほど等）
- [ ] 付箋の色選択
- [ ] エクスポート機能（PDF、画像）
- [ ] ボードテンプレート
- [ ] 投票制限機能

---

## 画面遷移図

```
[トップページ]
    │
    ├─→ [ボード作成画面] ─→ [ボード画面]
    │
    └─→ [招待URLアクセス] ─→ [ニックネーム入力] ─→ [ボード画面]
```

---

## 実装済みファイル構成

```
src/
├── app/
│   ├── globals.css          # グローバルスタイル
│   ├── layout.tsx           # ルートレイアウト
│   ├── page.tsx             # ボード作成画面
│   └── board/
│       └── [id]/
│           └── page.tsx     # ボード画面（メイン）
├── components/
│   ├── index.ts             # コンポーネントエクスポート
│   ├── Avatar.tsx           # アバターコンポーネント
│   ├── Header.tsx           # ヘッダーコンポーネント
│   ├── StickyNote.tsx       # 付箋コンポーネント
│   ├── NoteGroup.tsx        # グループコンポーネント
│   ├── FloatingInput.tsx    # 入力フォームコンポーネント
│   ├── InviteDialog.tsx     # 招待ダイアログ
│   ├── NicknameDialog.tsx   # ニックネーム入力ダイアログ
│   ├── ClickHint.tsx        # ヒント表示コンポーネント
│   └── ZoomControls.tsx     # ズームコントロールUI
├── hooks/
│   ├── useBoard.ts          # ボード操作カスタムフック
│   ├── useLocalStorage.ts   # ローカルストレージフック
│   └── useCanvasTransform.ts # ズーム・パン管理フック
├── lib/
│   ├── firebase.ts          # Firebase初期化
│   └── firestore.ts         # Firestore操作関数
└── types/
    └── index.ts             # 型定義
```

---

## 開発環境セットアップ

### 1. 依存関係インストール
```bash
npm install
```

### 2. Firebase設定
`.env.local.example` を `.env.local` にコピーし、Firebase プロジェクトの認証情報を設定:
```bash
cp .env.local.example .env.local
```

### 3. 開発サーバー起動
```bash
npm run dev
```

### 4. ビルド
```bash
npm run build
```

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-01-27 | 初版作成 |
| 2026-01-27 | Next.js実装完了 |
